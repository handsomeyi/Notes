# 减压

oss减少我们的主要流量压力 我们只处理订单信息 (Object Storage Service)

![image-20220216162102128](https://s2.loli.net/2022/02/16/mpEiTWO2GQsKkfg.png)

# 三级等保要求

电话号码 188xxxx0772

**对称加密**存入数据库

# 派单

使用redis : "业务名称" + driverID , value

解决每个司机要处理的抢单

# 5个司机抢单-分布式锁

且听下回分解

# 订单状态机

订单状态: 操作前状态 & 事件

需要注意的点:

- 日志记录, 记录状态变化过程 int

- 状态只能前进或停止

  **订单状态**

```java
订单预估 0  ---------->  取消订单 90
   ↓
订单开始 1  ---------->  取消订单 91
   ↓
司机接单 2  ---------->  取消订单 92
   ↓
去接乘客 3  ---------->  取消订单 93
   ↓
到上车点 4  ---------->  取消订单 94
   ↓
接到乘客 5  ---------->  取消订单 95
   ↓
开始行程 6
   ↓
结束行程 7  -->  (司机决定)(走一遍计价流程)
   ↓
发起收款 8
   ↓
乘客支付 9
   ↓
乘客评价 10
```



# 柔性事务 seata

![image-20220216171007089](https://s2.loli.net/2022/02/16/sHCDgu4JMVN2vfq.png)
