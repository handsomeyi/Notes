# TCP or UDP?

http://www.52im.net/thread-33-1-1.html

## 路由器的端口映射老化时间?

由于路由器端口映射的存在，加上智能终端频繁、长时间的休眠，TCP长连接的实用性在移动互联网情况下极大地打了折扣。

也因为如此，移动端IM、推送系统必须实现所谓的心跳包机制，以保持端口映射关系的老化时间不会减少到0而被回收，从而避免连接中断。

## 服务端承载能力

从承载能力来想的话, TCP必然是最保险的实现, 但是其计算, 网络资源的消耗也是巨大的.

百万级别的TCP连接的网络服务, 其编程, 程序复杂度, 调试难度, 运维成本, 网络成本都远高于UDP.

所以如果当某个服务不是基于流的服务, 可以考虑用UDP来实现, 可能更合适.

## 高级应用网络通讯要求

移动端IM系统、推送系统一方面提供终端在线服务，另外一方面也需要考虑内容信息的完整性和安全性。毕竟信息的丢失，或者通讯的被窃听，都是难以接受的。而TCP不管在网络层的可靠性控制，还是在应用层的安全支持（例如HTTPS），都为应用提供无法替代的强大功能和便利。

## 结论

现在的移动端IM、推送系统，既面对移动互联网的不确定性，又面对智能终端频繁的系统休眠、网络切换，还要考虑服务端的承载成本，对于在线服务而言UDP是比TCP更适合的方式。但是由于数据完整性、安全性的需要，又不应完全放弃TCP的可靠与安全。

个人认为, 更恰当的方式应该是：**两种通信协议同时使用，各有侧重。**
UDP: ==**大量终端的在线与控制**==(发收心跳包)
TCP: ==**应用与业务**==

