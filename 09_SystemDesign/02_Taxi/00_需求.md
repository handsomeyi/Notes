# 

# ==BOSS需求==

## 计价系统

### 目的

```shell
目的：
1、提供可灵活配置计费规则的功能界面；
2、支持分段计价，按照不同时段不同里程计费与时长计费；
3、支持定时生效新的计费规则；
4、留存历史计费信息；
5、支持“即时用车”的动态折扣设置；

其他关注事项：

注1：当“下单”时，就记录其订单的计费规则，并镜像一份当时的计费信息；
注2：计费规则中的配置项，只支持小数点后一位，计算订单金额时，计算至小数点后两位，不用考虑第三位的四舍五入问题。
注3、订单金额；（v0.2）
（1）如果配置“最低消费”，若订单金额<最低消费，则按照最低消费进行结算；
（2）如果下单时，有符合“动态调价”，则，先计算优惠券折扣或金额，在计算动态调价。
（2）如果下单时，有符合“动态调价”，则，先计算动态调价，再计算优惠券折扣或金额。（v0.3）
```



### 预估“订单金额”计算：

```shell
预估“订单金额”计算：

计算公式：
情况1：包含套餐（包含公里数、包含服务时长数），不包含“分段计费”：
订单金额 = 基础价格 +（ 预估里程数 - 包含公里数）* 超公里单价（注3） + （预估服务时长数 - 包含服务时长数）* 超时间单价（注3） +（预估里程数 - 远途起算公里）* 远途单价 + 夜间服务费（注2）

情况2：不包含套餐（包含公里数、包含服务时长数），包含“分段计费”：
订单金额 = 基础价格 +里程费用（注4） + 时长费用（注4） +（预估里程数 - 远途起算公里）* 远途单价 + 夜间服务费（注2）

注1：以上“订单金额”算出后，与“最低消费”进行对比，若“订单金额”>="最低消费",则收费按照“订单金额”，反之按照"最低消费"收取;
注2：
（1）"预估夜间服务费"，是追加收取的费用，与720版本中所计算的方式不同，也与套餐中包含的“公里数”与“时长数”无关；
（2）预估夜间服务费的产生，指预估行程中，“行驶的时间段”与“夜间时段”有交叉、重合，的“交集”部分，对应的“预估夜间行驶时间段”与“预估夜间行驶时间段的里程数”作为计算依据；
（3）预估夜间服务费 = 预估夜间行驶时间段 * 夜间加收公里单价 + 预估夜间行驶时间段的里程数 * 夜间加收时间单价（v1.7）
注3：其中“超公里单价”与“超时长单价”为“普通时段计费”；
注4：若“情况2”"超公里单价"与“超时长单价”是按照分段计价的方式，则按照"预估服务时长"，与"时间段"进行比较，若"预估服务时长"属于某些"时间段"则按照对应的“超公里单价”与“超时长单价”计算：
计费规则 如：基础价格500元，
                     普通时段：超公里单价:1.0元/公里  超时长单价：1.0元/分钟
                     6:00-7:59  超公里单价:2.0元/公里  超时长单价：2.0元/分钟
                     8:00-9:59  超公里单价:3.0元/公里  超时长单价：3.0元/分钟

               若：预估行驶里程100公里，预估时长：6小时(6:00-11:59)
                      6:00-7:59  行驶20公里  120分钟
                      8:00-9:59  行驶30公里  120分钟
                      10:00-11:59  行驶50公里  120分钟
              计算：
                      公里费部分1（6:00-7:59  行驶20公里） = 20*2.0
                      公里费部分2（8:00-9:59  行驶30公里） = 30*3.0
                      公里费部分3（10:00-11:59  行驶50公里） = 50*1.0
                      则：里程费用 = 公里费部分1 + 公里费部分2 + 公里费部分3
                      时长费部分1（6:00-7:59  120分钟）= 120*2.0
                      时长费部分2（8:00-9:59  120分钟）= 120*3.0
                      时长费部分3（10:00-11:59  120分钟）= 120*1.0
                      则：时长费用 = 时长费部分1 + 时长费部分2 + 时长费部分3

注5：以上公式中，进行减法运算时，当值为“负数”时，替换成“0”；
```

### 实际“订单金额”计算

```shell
实际“订单金额”计算：

计算公式：
情况1：包含套餐（包含公里数、包含服务时长数），不包含“分段计费”：

订单金额 = 基础价格 +（ 实际里程数 - 包含公里数）* 超公里单价（注3） + （实际服务时长数 - 包含服务时长数）* 超时间单价（注3） +（实际里程数 - 远途起算公里）* 远途单价 + 夜间服务费（注2）

情况2：不包含套餐（包含公里数、包含服务时长数），包含“分段计费”：

订单金额 = 基础价格 +里程费用（注4） + 时长费用（注4） +（实际里程数 - 远途起算公里）* 远途单价 + 夜间服务费（注2）


# 注1：以上“订单金额”算出后，与“最低消费”进行对比，若“订单金额”>="最低消费",则收费按照“订单金额”，反之按照"最低消费"收取;
# 注2：
（1）"夜间服务费"，是追加收取的费用，与720版本中所计算的方式不同，也与套餐中包含的“公里数”与“时长数”无关；
（2）夜间服务费的产生，指实际行程过程中，“行驶的时间段”与“夜间时段”有交叉、重合，的“交集”部分，对应的“夜间行驶时间段”与“夜间行驶时间段的里程数”作为计算依据；
（3）夜间服务费 = 夜间行驶时间段 * 夜间加收公里单价 + 夜间行驶时间段的里程数 * 夜间加收时间单价（v1.7）
# 注3：其中“超公里单价”与“超时长单价”为“普通时段计费”；
# 注4：若“情况2”"超公里单价"与“超时长单价”是按照分段计价的方式，则按照"实际服务时长"，与"时间段"进行比较，若"实际服务时长"属于某些"时间段"则按照对应的“超公里单价”与“超时长单价”计算：
计费规则 如：基础价格500元，
                     普通时段：超公里单价:1.0元/公里  超时长单价：1.0元/分钟
                     6:00-7:59  超公里单价:2.0元/公里  超时长单价：2.0元/分钟
                     8:00-9:59  超公里单价:3.0元/公里  超时长单价：3.0元/分钟
               若：实际行驶里程100公里，实际时长：6小时(6:00-11:59)
                      6:00-7:59  行驶20公里  120分钟
                      8:00-9:59  行驶30公里  120分钟
                      10:00-11:59  行驶50公里  120分钟
            计算：
                      公里费部分1（6:00-7:59  行驶20公里） = 20*2.0
                      公里费部分2（8:00-9:59  行驶30公里） = 30*3.0
                      公里费部分3（10:00-11:59  行驶50公里） = 50*1.0
                      则：里程费用 = 公里费部分1 + 公里费部分2 + 公里费部分3

                      时长费部分1（6:00-7:59  120分钟）= 120*2.0
                      时长费部分2（8:00-9:59  120分钟）= 120*3.0
                      时长费部分3（10:00-11:59  120分钟）= 120*1.0
                      则：时长费用 = 时长费部分1 + 时长费部分2 + 时长费部分3

注5：以上公式中，进行减法运算时，当值为“负数”时，替换成“0”；
```



## 消息系统

### 目的

```shell
目的：
1、提供可靠的，稳定的消息引擎系统；
2、封装成可供多端应用推送、及短信发送能力；
2、实现操作员主动编辑APP推送内容，系统自动触发调用；
3、实现操作员，发送单人、多人短信发送功能界面，及系统自动触发调用；
4、提供可引用的字段标签、文案模板，及维护功能；
5、提供历史信息查询功能。
注1：当前消息类的查询列表，只做“短信”类的查询，至于“APP推送消息”的查询，后期考虑再加。（v0.2）
注2：账户系统的建立，对“消息推送”的影响说明：(v1.3)
（1）消息推送，其中“客户端”与“司机端”，是发送给该用户对应的“YID”中去；
```

![image-20220427011733574](https://s2.loli.net/2022/04/27/DpaqEMoRBK8hmdX.png)



### 消息推送Boss设置

file:///D:/sourse/1ForInternetArchitect/online-taxi-file-all/online-taxi-file1-master/%E4%B8%89%E6%9C%9F/%E9%9C%80%E6%B1%82/boss%E9%9C%80%E6%B1%82-03/index.html#g=1&p=%E6%B7%BB%E5%8A%A0_%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81

file:///D:/sourse/1ForInternetArchitect/online-taxi-file-all/online-taxi-file1-master/%E4%B8%89%E6%9C%9F/%E9%9C%80%E6%B1%82/boss%E9%9C%80%E6%B1%82-03/index.html#g=1&p=%E6%9F%A5%E7%9C%8B_%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81

# ==乘客端需求==

## 实时单流程——首页

实时单—确认起点
实时单—确认目的地

## 预约单流程

实时单—确认起点
实时单—确认目的地
预约单—选择出行时间

## 取消订单需求



# ==司机端==

## 司机端需求脑图

![image-20220427010802783](https://s2.loli.net/2022/04/27/P7QAtzOnih4gVaH.png)

## 抢单业务流程

![image-20220427012633962](https://s2.loli.net/2022/04/27/igwx5qmPFktYQd3.png)

## 预约业务流程

![image-20220427012720896](https://s2.loli.net/2022/04/27/xcPAXSJQGW31bVL.png)